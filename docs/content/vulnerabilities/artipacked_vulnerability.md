# ArtiPACKED Artifact Leakage

## Description

Uploading workflow artifacts without adequate filtering or retention allows sensitive data—like `GITHUB_TOKEN` values persisted by `actions/checkout` or environment variables logged by tools such as `super-linter`—to leak into publicly accessible artifacts for up to 90 days. Attackers who download those artifacts gain the same repository or cloud access that the leaked tokens grant, enabling code tampering or lateral movement across CI/CD-integrated services. [^artipacked]

## Vulnerable Instance

- A workflow uploads the entire checkout directory (including `.git/`) as an artifact, so the persisted `GITHUB_TOKEN` is bundled and exposed once the run completes.
- Logs generated by `super-linter` with `CREATE_LOG_FILE=true` capture environment variables, then get uploaded as artifacts, unintentionally publishing GitHub and cloud tokens. [^artipacked]

```yaml
jobs:
  lint-and-archive:
    steps:
      - uses: actions/checkout@v4
        # Default persist-credentials=true stores GITHUB_TOKEN in .git/
      - uses: super-linter/super-linter@v6
        env:
          CREATE_LOG_FILE: true
      - uses: actions/upload-artifact@v4
        with:
          name: full-checkout
          path: .
          retention-days: 90
```

## Mitigation Strategies

1. **Scope artifact contents**  
   Restrict `actions/upload-artifact` inputs to the minimal set of files required and exclude checkout directories or logs that could contain secrets.
2. **Disable credential persistence**  
   Set `persist-credentials: false` on `actions/checkout` unless authenticated git operations are necessary.
3. **Scrub and scan artifacts**  
   Run automated secret scanners (e.g., `upload-secure-artifact`) before uploading artifacts; fail the workflow if high-risk findings appear.
4. **Harden logging and tooling**  
   Configure linters and build tools to avoid logging environment variables or secrets; keep `CREATE_LOG_FILE` disabled unless logs are sanitized.
5. **Limit retention and permissions**  
   Set `retention-days` to the minimum viable duration and enforce least-privilege permissions on `GITHUB_TOKEN` to reduce blast radius if leakage occurs.

### Secure Version

- Artifact uploads explicitly include only the files needed downstream (for example, `dist/**` or `reports/*.xml`) and exclude `.git/`, `.env`, and other sensitive paths.
- Tools like `super-linter` run with secret-scrubbed logging, and workflows scan artifact contents before upload using a guard action such as Palo Alto Networks’ `upload-secure-artifact`, which blocks artifacts containing detected secrets. [^artipacked]

```yaml
jobs:
  build:
    steps:
      - uses: actions/checkout@v4
        with:
          persist-credentials: false
      - run: npm run build
      - uses: paloaltonetworks/upload-secure-artifact@v1
        with:
          name: dist-bundle
          path: dist/**
          retention-days: 14
```

## Impact

| Dimension | Severity | Notes |
| --- | --- | --- |
| Likelihood | ![High](https://img.shields.io/badge/-High-orange?style=flat-square) | Default `actions/checkout` + broad artifact uploads are pervasive, so leaks are common. |
| Risk | ![Critical](https://img.shields.io/badge/-Critical-red?style=flat-square) | Exposed `GITHUB_TOKEN` or cloud keys enable repo takeover and supply-chain tampering. |
| Blast radius | ![Wide](https://img.shields.io/badge/-Wide-yellow?style=flat-square) | Any system tied to the leaked token (deploy targets, registries, cloud accounts) is impacted. |

## References

- Palo Alto Networks Unit 42, “ArtiPACKED: Hacking Giants Through a Race Condition in GitHub Actions Artifacts,” Aug 13, 2024. https://unit42.paloaltonetworks.com/github-repo-artifacts-leak-tokens/ [^artipacked]
- GitHub Docs, “Store workflow data as artifacts,” https://docs.github.com/actions/using-workflows/storing-workflow-data-as-artifacts

[^artipacked]: Palo Alto Networks Unit 42, “ArtiPACKED: Hacking Giants Through a Race Condition in GitHub Actions Artifacts,” Aug 13, 2024. https://unit42.paloaltonetworks.com/github-repo-artifacts-leak-tokens/

