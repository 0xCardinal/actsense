name: Cleanup Checkout

on:
  workflow_dispatch:
  schedule:
    - cron: '0 3 * * *'

jobs:
  cleanup:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 1

      - name: Show what we got
        run: |
          echo "Current directory: $(pwd)"
          ls -la

      - name: Delete the checkout
        run: |
          WORKSPACE="${{ github.workspace }}"
          cd "$(dirname "$WORKSPACE")"
          
          if [ -d "$WORKSPACE" ]; then
            echo "Deleting: $WORKSPACE"
            rm -rf "$WORKSPACE"
            echo "Done."
          fi
          
          if [ ! -d "$WORKSPACE" ]; then
            echo "Confirmed: directory deleted"
          fi

      - name: Verify it's gone
        run: |
          WORKSPACE="${{ github.workspace }}"
          if [ ! -d "$WORKSPACE" ]; then
            echo "Cleanup successful"
          else
            echo "Cleanup failed"
            exit 1
          fi

